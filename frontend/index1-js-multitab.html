<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .tab-container {
            display: flex;
            border-bottom: 2px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid #ddd;
            border-bottom: none;
            background-color: #f9f9f9;
            margin-right: 5px;
        }
        .tab.active {
            background-color: white;
            border-top: 2px solid #000;
        }
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            margin-top: -1px;
        }
        .tab-content.active {
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .button-container {
            float: right;
        }
        .button-container button {
            margin-left: 10px;
        }
        .locked {
        opacity: 0.5;
        pointer-events: none;
        }
    </style>
</head>
<body>

    <!-- Tabs -->
    <div class="tab-container">
        <div class="tab active" onclick="openTab('tab1')">Players</div>
        <div class="tab" onclick="openTab('tab2')">Pairing</div>
        <div class="tab" onclick="openTab('tab3')">Standing</div>
    </div>

    <!-- Tab 1: Add Player to Table -->
    <div id="tab1" class="tab-content active">
        <h2>Add Player to Table</h2>
        <input type="text" id="name" placeholder="Enter name" required>
        <input type="number" id="Elo" placeholder="Enter Elo" required>
        <button onclick="addToTable()">Add</button>
        <div class="button-container">
            <button onclick="sortPlayers()">Sort Players</button>
            <button onclick="randomizePlayers()">Randomize Players</button>
            <button onclick="clearTable()">Clear Table</button>
            <input type="file" id="csvFileInput" accept=".csv" style="display:none" onchange="importFromCSV(event)">
            <button onclick="document.getElementById('csvFileInput').click()">Import from CSV</button>
            <button onclick="exportToCSV()">Export to CSV</button>
            <button onclick="lockAndPairing()">Lock & Start Pairing</button>

        </div>

        <table id="dataTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Elo</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <!-- Rows will be added here -->
            </tbody>
        </table>
    </div>

    <!-- Tab 2: Pairing -->
    <div id="tab2" class="tab-content">
        <h2>Pairing</h2>
        <p>Pairing logic will be implemented here.</p>
    </div>

    <!-- Tab 3: Standing -->
    <div id="tab3" class="tab-content">
        <h2>Standing</h2>
        <p>Standing logic will be implemented here.</p>
    </div>

    <script>
        let players = []; // Store input data

        function addToTable() {
            let name = document.getElementById("name").value;
            let Elo = document.getElementById("Elo").value;
            if (!Elo) {
                Elo = 1400; // Default Elo value
            }
            if (name && Elo) {
                let table = document.getElementById("dataTable").getElementsByTagName('tbody')[0];
                let newRow = table.insertRow();

                let nameCell = newRow.insertCell(0);
                let EloCell = newRow.insertCell(1);
                let actionCell = newRow.insertCell(2);

                nameCell.textContent = name;
                EloCell.textContent = Elo;
                actionCell.innerHTML = '<button onclick="deleteRow(this)">Delete</button>';

                // Store in variable
                players.push({ name: name, Elo: Number(Elo) });

                // Clear input fields
                document.getElementById("name").value = "";
                document.getElementById("Elo").value = "";

                console.log(players); // Debugging
            } else {
                alert("Please enter both name and Elo.");
            }
        }

        function deleteRow(button) {
            let row = button.parentNode.parentNode;
            let rowIndex = row.rowIndex - 1; // Adjust for header row
            players.splice(rowIndex, 1); // Remove from players array
            row.parentNode.removeChild(row); // Remove row from table

            console.log(players); // Debugging
        }

        function sortPlayers() {
            players.sort((a, b) => b.Elo - a.Elo); // Sort players by Elo in descending order
            updateTable();
        }

        function randomizePlayers() {
            for (let i = players.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [players[i], players[j]] = [players[j], players[i]];
            }
            updateTable();
        }

        function clearTable() {
            let table = document.getElementById("dataTable").getElementsByTagName('tbody')[0];
            table.innerHTML = ""; // Clear all rows
            players = []; // Clear players array
            console.log(players); // Debugging
        }

        function exportToCSV() {
            let csvContent = "data:text/csv;charset=utf-8,Name,Elo\n";
            players.forEach(player => {
                csvContent += `${player.name},${player.Elo}\n`;
            });
        
            let encodedUri = encodeURI(csvContent);
            let link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "players.csv");
            document.body.appendChild(link); // Required for FF
        
            link.click();
            document.body.removeChild(link); // Clean up
        }

        function importFromCSV(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const rows = text.split('\n').slice(1); // Skip header row
                rows.forEach(row => {
                    const [name, Elo] = row.split(',');
                    if (name && Elo) {
                        players.push({ name: name.trim(), Elo: Number(Elo.trim()) });
                    }
                });
                updateTable();
            };
            reader.readAsText(file);
        }

        function lockAndPairing() {
            // Disable input fields
            document.getElementById("name").disabled = true;
            document.getElementById("Elo").disabled = true;

            // Disable buttons
            document.querySelectorAll('.button-container button').forEach(button => {
                button.disabled = true;
            });
        
            // Optionally, add a visual indication that the table is locked
            document.getElementById("dataTable").classList.add('locked');
        
            console.log("Table locked and pairing started.");
        }

        function updateTable() {
            let table = document.getElementById("dataTable").getElementsByTagName('tbody')[0];
            table.innerHTML = ""; // Clear existing rows

            players.forEach(player => {
                let newRow = table.insertRow();

                let nameCell = newRow.insertCell(0);
                let EloCell = newRow.insertCell(1);
                let actionCell = newRow.insertCell(2);

                nameCell.textContent = player.name;
                EloCell.textContent = player.Elo;
                actionCell.innerHTML = '<button onclick="deleteRow(this)">Delete</button>';
            });
        }

        function openTab(tabId) {
            let tabs = document.querySelectorAll('.tab-content');
            let tabButtons = document.querySelectorAll('.tab');

            tabs.forEach(tab => tab.classList.remove('active'));
            tabButtons.forEach(tab => tab.classList.remove('active'));

            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.tab-container .tab[onclick="openTab('${tabId}')"]`).classList.add('active');
        }
    </script>

</body>
</html>